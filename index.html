<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—è—Ç–Ω–∞—à–∫–∏–Ω—ÅüéÄ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            flex-direction: column;
        }

        .game-field {
            display: grid;
            gap: 5px;
            margin: 20px auto;
            border: 2px solid #4caf50;
            touch-action: none;
            border-radius: 10px;
            background-color: #fff;
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 1;
        }

        .tile {
            background-color: #ffeb3b;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            font-weight: bold;
            border-radius: 8px;
            transition: transform 0.3s ease, opacity 0.5s ease;
            position: absolute;
            width: 70px; /* –†–∞–∑–º–µ—Ä –ø–ª–∏—Ç–∫–∏ */
            height: 70px; /* –†–∞–∑–º–µ—Ä –ø–ª–∏—Ç–∫–∏ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            opacity: 0;
            cursor: pointer;
        }

        .tile.show {
            opacity: 1;
        }

        .tile.correct {
            border: 2px solid #4caf50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
        }

        .empty-tile {
            background-color: transparent;
            color: transparent;
            border: none;
            box-shadow: none;
        }

        .color-picker-container {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
        }

        label {
            margin-right: 10px;
            font-weight: bold;
            color: #333;
        }

        input[type="color"] {
            border: none;
            padding: 5px;
            cursor: pointer;
            border-radius: 5px;
        }

        #modeSwitcher {
            padding: 8px 12px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            transition: background-color 0.3s ease;
            max-width: 150px;
            width: 100%;
        }

        #modeSwitcher:hover {
            background-color: #45a049;
        }

        .game-controls {
            text-align: center;
            max-width: 320px;
            width: 100%;
            margin-top: 20px;
        }

        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        .color-picker-container,
        .game-controls {
            margin-top: 15px;
        }

        @media (max-width: 480px) {
            .tile {
                width: 60px; /* –£–º–µ–Ω—å—à–∞–µ–º –ø–ª–∏—Ç–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
                height: 60px; /* –£–º–µ–Ω—å—à–∞–µ–º –ø–ª–∏—Ç–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
                font-size: 30px; /* –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            }

            .game-field {
                gap: 4px;
                margin: 15px auto;
            }

            #modeSwitcher {
                padding: 6px 10px;
                font-size: 12px;
                width: 90%;
            }

            .color-picker-container {
                font-size: 12px;
            }
        }

    </style>
</head>
<body>
    <div class="game-controls">
        <h1>–ü—è—Ç–Ω–∞—à–∫–∏–Ω—ÅüéÄ</h1>
        <div class="game-field" id="gameField"></div>
        <div class="color-picker-container">
            <label for="tileColor">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –ø–ª–∏—Ç–æ–∫:</label>
            <input type="color" id="tileColor" value="#ffeb3b">
        </div>
        <select id="modeSwitcher">
            <option value="3">3x3</option>
            <option value="4" selected>4x4</option>
            <option value="5">5x5</option>
            <option value="6">6x6</option>
            <option value="7">7x7</option>
            <option value="8">8x8</option>
            <option value="9">9x9</option>
            <option value="10">10x10</option>
        </select>
    </div>

    <script>
        const gameField = document.getElementById('gameField');
        const modeSwitcher = document.getElementById('modeSwitcher');
        const tileColorPicker = document.getElementById('tileColor');
        let tiles = [];
        let emptyTileIndex = 15;
        let swipeStartX, swipeStartY;
        let currentColor = '#ffeb3b';
        let currentSize = 4; // –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–ª—è

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function createGame(size) {
            gameField.innerHTML = '';
            tiles = [];
            emptyTileIndex = size * size - 1;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –ø–æ–ª—è
            gameField.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            gameField.style.gridTemplateRows = `repeat(${size}, 1fr)`;
            gameField.style.width = `${size * 70}px`; // 70px (–ø–ª–∏—Ç–∫–∞)
            gameField.style.height = `${size * 70}px`;

            // –°–æ–∑–¥–∞–µ–º –ø–ª–∏—Ç–∫–∏
            for (let i = 1; i <= size * size - 1; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.textContent = i;
                tile.id = `tile-${i}`;
                tiles.push(tile);
                gameField.appendChild(tile);
            }

            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é –ø–ª–∏—Ç–∫—É
            const emptyTile = document.createElement('div');
            emptyTile.className = 'empty-tile';
            emptyTile.id = 'empty-tile';
            tiles.push(emptyTile);
            gameField.appendChild(emptyTile);

            // –†–∏—Å—É–µ–º –ø–ª–∏—Ç–∫–∏
            renderTiles(size);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –ø–ª–∏—Ç–æ–∫
        function shuffleTiles() {
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–ª–∏—Ç–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ–º
            tiles.forEach(tile => tile.classList.remove('show'));

            setTimeout(() => {
                for (let i = tiles.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
                }
                emptyTileIndex = tiles.findIndex(tile => tile.id === 'empty-tile');
                renderTiles(currentSize);

                // –ü–ª–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∏—Ç–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
                tiles.forEach(tile => tile.classList.add('show'));
            }, 500); // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ–º –ø–ª–∏—Ç–æ–∫
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ —Ö–æ–¥–∞
        function isValidMove(fromIndex, toIndex, size) {
            const rowDiff = Math.abs(Math.floor(fromIndex / size) - Math.floor(toIndex / size));
            const colDiff = Math.abs((fromIndex % size) - (toIndex % size));
            return rowDiff + colDiff === 1;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–ª–∏—Ç–∫–∏
        function moveTile(tileIndex, size) {
            if (isValidMove(tileIndex, emptyTileIndex, size)) {
                [tiles[emptyTileIndex], tiles[tileIndex]] = [tiles[tileIndex], tiles[emptyTileIndex]];
                emptyTileIndex = tileIndex;
                renderTiles(size);
                highlightCorrectTiles(size); // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–µ—Ä–Ω—ã—Ö –ø–ª–∏—Ç–æ–∫
                saveGameState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞

                if (checkWin(size)) {
                    showCongratulationsMessage();
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã
        function checkWin(size) {
            for (let i = 0; i < size * size - 1; i++) {
                if (parseInt(tiles[i].textContent) !== i + 1) {
                    return false;
                }
            }
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–±–µ–¥–µ
        function showCongratulationsMessage() {
            alert("–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í—ã —Å–æ–±—Ä–∞–ª–∏ –≤—Å–µ –ø–ª–∏—Ç–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!");
            shuffleTiles();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–ª–∏—Ç–æ–∫
        function renderTiles(size) {
            tiles.forEach((tile, index) => {
                const row = Math.floor(index / size);
                const col = index % size;
                tile.style.transform = `translate(${col * 70}px, ${row * 70}px)`; // –£—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function saveGameState() {
            const tileNumbers = tiles.map(tile => tile.textContent || '');
            const gameState = {
                size: currentSize,
                tiles: tileNumbers,
                emptyTileIndex: emptyTileIndex,
                color: currentColor
            };
            localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function loadGameState() {
            const savedState = localStorage.getItem('gameState');
            if (savedState) {
                const gameState = JSON.parse(savedState);
                currentSize = gameState.size;
                currentColor = gameState.color;
                createGame(currentSize);
                tiles.forEach((tile, index) => {
                    tile.textContent = gameState.tiles[index];
                });
                emptyTileIndex = gameState.emptyTileIndex;
                renderTiles(currentSize);
                updateTileColors(currentColor);
                highlightCorrectTiles(currentSize); // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–µ—Ä–Ω—ã—Ö –ø–ª–∏—Ç–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤–µ—Ä–Ω—ã—Ö –ø–ª–∏—Ç–æ–∫
        function highlightCorrectTiles(size) {
            tiles.forEach((tile, index) => {
                if (tile.textContent && parseInt(tile.textContent) === index + 1) {
                    tile.classList.add('correct');
                } else {
                    tile.classList.remove('correct');
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–≤–∞–π–ø–æ–≤ (—Ç–∞—á-—Å–æ–±—ã—Ç–∏–π)
        gameField.addEventListener('touchstart', (e) => {
            swipeStartX = e.touches[0].clientX;
            swipeStartY = e.touches[0].clientY;
        });

        gameField.addEventListener('touchmove', (e) => {
            e.preventDefault();
        });

        gameField.addEventListener('touchend', (e) => {
            const swipeEndX = e.changedTouches[0].clientX;
            const swipeEndY = e.changedTouches[0].clientY;

            const deltaX = Math.abs(swipeEndX - swipeStartX);
            const deltaY = Math.abs(swipeEndY - swipeStartY);

            let direction;
            if (deltaX > deltaY) {
                direction = swipeEndX < swipeStartX ? 'left' : 'right';
            } else if (deltaY > deltaX) {
                direction = swipeEndY < swipeStartY ? 'up' : 'down';
            } else {
                return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã
            }

            const emptyTileRow = Math.floor(emptyTileIndex / currentSize);
            const emptyTileCol = emptyTileIndex % currentSize;

            let tileToMove;
            switch (direction) {
                case 'left':
                    tileToMove = tiles[emptyTileIndex + 1];
                    break;
                case 'right':
                    tileToMove = tiles[emptyTileIndex - 1];
                    break;
                case 'up':
                    tileToMove = tiles[emptyTileIndex + currentSize];
                    break;
                case 'down':
                    tileToMove = tiles[emptyTileIndex - currentSize];
                    break;
            }

            if (tileToMove && isValidMove(tiles.indexOf(tileToMove), emptyTileIndex, currentSize)) {
                moveTile(tiles.indexOf(tileToMove), currentSize);
            }
        });

        document.getElementById('tileColor').addEventListener('change', (e) => {
            currentColor = e.target.value;
            updateTileColors(currentColor);
            saveGameState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
        });

        function updateTileColors(color) {
            tiles.forEach(tile => {
                if (!tile.classList.contains('empty-tile')) {
                    tile.style.backgroundColor = color;
                }
            });
        }

        modeSwitcher.addEventListener('change', function() {
            const size = parseInt(this.value);
            currentSize = size;
            createGame(size);
            shuffleTiles();
        });

        createGame(4); // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã —Å 4x4
        shuffleTiles();
    </script>
</body>
</html>
